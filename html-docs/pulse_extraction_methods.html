<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Qudi: Concept of pulse extraction methods</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Qudi
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Concept of pulse extraction methods </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>General description</h2>
<p>The extraction methods take a 1D (for continuous counting) or 2D (for gated counting) integer array representing the count trace as input together with method specific parameters. In case of gated counting, the first dimension of the count array is the gate index and the second dimension is the time bin index of the corresponding time trace.</p>
<p>Based on these inputs it will extract the actual laser-on part of the timetrace for each laser pulse. So the returned object will be a 2D integer numpy array with the first dimension being the index of the laser pulse and the second dimension being the count trace of the corresponding laser pulse.</p>
<h2>Architecture</h2>
<p>Each extraction method is a bound method of a child class of <code>PulseExtractorBase</code>. This base class provides read-only access to important attributes of <code>PulsedMeasurementLogic</code> via properties. (see ./logic/pulsed/pulse_extractor.py) For the extraction you can therefore access all the information contained in <code>PulsedMeasurementLogic</code>, namely:</p><ul>
<li><code>is_gated</code> (bool indicating if the fast counter is gated or not)</li>
<li><code>measurement_settings</code> (dict containing the parameters to define the current measurement)</li>
<li><code>sampling_information</code> (dict containing information about the discretization of the currently loaded waveform/sequence)</li>
<li><code>fast_counter_settings</code> (dict containing the current settings for the fast counter hardware)</li>
</ul>
<p>If you need access to another attribute of the logic module simply add it as property to <code>PulseExtractorBase</code> but make sure to protect it properly against changes to the logic module.</p>
<p>In addition the base class provides access to the qudi logger which can be used just like in any other qudi module, e.g. `self.log.warning('I am a warning!')`</p>
<p>All parameters needed for the pulse extraction that can not be provided by the logic module need to be handed over to the extraction method directly as keyword arguments with default value.</p>
<p>When activating the <code>PulsedMeasurementLogic</code>, an instance of <code>PulseExtractor</code> will be created. This class finds and imports all child classes of <code>PulseExtractorBase</code> from the default directory ./logic/pulsed/pulse_extraction_methods/. It will also inspect the extraction methods and create two dictionaries. One is holding references to the method itself and the other contains the keyword arguments together with the currently set values for each extraction method. In both cases the dictionary keys are the method names excluding the "analyse_" naming prefix. Those two dictionaries can be accessed via properties of <code>PulseExtractor</code>. The property holding the extraction parameters is masked in order to only return or set the parameter set for the currently selected extraction method.</p>
<h2>Method signature</h2>
<p>Each extraction method must meet the following requirements:</p><ul>
<li>Is bound instance method of a <code>PulseExtractorBase</code> child class</li>
<li>Method name starts with prefix <code>gated_</code> for extraction of gated counter timetraces or <code>ungated_</code> for extraction of continuous counter timetraces.</li>
<li>First argument (after <code>self</code>) must be named <code>count_data</code></li>
<li>Additional parameters must be defined as optional keyword arguments</li>
<li>Default values for additional arguments must be of type <code>int</code>, <code>float</code>, <code>str</code> or <code>bool</code>. Depending on the default argument type the GUI will automatically create the proper input widget.</li>
</ul>
<h2>Adding new methods procedure</h2>
<ol type="1">
<li>Define a class with <code>PulseExtractorBase</code> as the <b>ONLY</b> parent class.</li>
<li>Make sure the base class gets initialized with: ```python def <b>init</b>(self, *args, **kwargs): super().__init__(*args, **kwargs) ```</li>
<li>Define extraction methods in new class. (see section "Method signature")</li>
<li>Place the module containing your class definition in the default directory to import from (<code>./logic/pulsed/pulse_extraction_methods/</code>) or put it in a custom directory and specify the path in your config for the <code>PulsedMeasurementLogic</code> as ConfigOption "additional_extraction_path".</li>
</ol>
<p>You can also simply add your extraction method to an already existing <code>PulseExtractorBase</code> child class. In that case you just need to follow step 3.</p>
<p>By default <em>qudi</em> ships with the default methods defined in <code>./logic/pulsed/pulse_extraction_methods/basic_extraction_methods.py</code>. This module should not be altered unless you intend to contribute your methods to the <em>qudi</em> repository.</p>
<p>A template for a new <code>PulseExtractor</code> class could look like: </p><div class="fragment"><div class="line">class MyPulseExtractor(PulseExtractorBase):</div><div class="line">    &quot;&quot;&quot; Description goes here &quot;&quot;&quot;</div><div class="line">    def __init__(self, *args, **kwargs):</div><div class="line">        super().__init__(*args, **kwargs)</div><div class="line"></div><div class="line">    def gated_my_method_name1(self, count_data, my_float_param=42.0, my_int_param=42):</div><div class="line">        # Do something</div><div class="line">        pass</div><div class="line"></div><div class="line">    def ungated_my_method_name2(self, count_data, my_str_param=&#39;derp&#39;, my_bool_param=True):</div><div class="line">        # Do something</div><div class="line">        pass</div><div class="line"></div><div class="line">    def _some_helper_method(self):</div><div class="line">        pass</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
