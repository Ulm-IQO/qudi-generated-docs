<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Qudi: National Instruments X Series Data Acquisition Cards</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Qudi
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">National Instruments X Series Data Acquisition Cards </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Introduction</h2>
<p>A National Instruments device that can count, record analog signals and control analog scanners and microvave generators</p>
<p><b>!!!!!! This module only works with NI USB 63XX, NI PCIe 63XX and NI PXIe 63XX devices Other devices do not have enough hardware counters or the counters do not support all required functionality. !!!!!!!</b></p>
<p>Basic procedure how the NI card is configured:</p><ul>
<li>At first you have to define a channel, where the APD clicks will be received. That can be any PFI input, which is specified to record TTL pulses.</li>
<li>Then the counter channels have to be configured.</li>
<li>One counter channel serves as a timing device, i.e. basically a clock which runs at a certain given frequency.</li>
<li>The second counter channel will be used as a counting device, which will, dependent on the clock, count within the clock interval. The faster the clock channel is configured, the smaller is the counting interval and the less counts per clock periode you will count.</li>
</ul>
<p><a href="http://www.ni.com/example/6999/en/#ANSIC">Text Based NI-DAQmx Data Acquisition Examples</a></p>
<h2>Terminology</h2>
<p>Explanation of the terminology, which is used in the NI Card and useful to know in for working with our implementation:</p>
<h4>Hardware-Timed Counter Tasks:</h4>
<p>Use hardware-timed counter input operations to drive a control loop. A really good explanation can be found in:</p>
<p><a href="http://zone.ni.com/reference/en-XX/help/370466V-01/mxcncpts/controlappcase4/">http://zone.ni.com/reference/en-XX/help/370466V-01/mxcncpts/controlappcase4/</a></p>
<h4>Terminals:</h4>
<p>A terminal is a named location where a signal is either generated (output or produced) or acquired (input or consumed). A terminal that can output only one signal is often named after that signal. A terminal with an input that can be used only for one signal is often named after the clock or trigger that the signal is used for. Terminals that are used for many signals have generic names such as RTSI, PXITrig, or PFI.</p>
<p><a href="http://zone.ni.com/reference/en-XX/help/370466W-01/mxcncpts/terminal/">http://zone.ni.com/reference/en-XX/help/370466W-01/mxcncpts/terminal/</a> <a href="http://zone.ni.com/reference/en-XX/help/370466V-01/mxcncpts/termnames/">http://zone.ni.com/reference/en-XX/help/370466V-01/mxcncpts/termnames/</a></p>
<h5>Ctr0Out, Ctr1Out, Ctr2Out, Ctr3Out</h5>
<p>Terminals at the I/O connector where the output of counter 0, counter 1, counter 2, or counter 3 can be emitted. You also can use Ctr0Out as a terminal for driving an external signal onto the RTSI bus.</p>
<h5>Ctr0Gate, Ctr1Gate, Ctr2Gate, Ctr3Gate</h5>
<p>Terminals within a device whose purpose depends on the application. Refer to Counter Parts in NI-DAQmx for more information on how the gate terminal is used in various applications.</p>
<h5>Ctr0Source, Ctr1Source, Ctr2Source, Ctr3Source</h5>
<p>Terminals within a device whose purpose depends on the application. Refer to Counter Parts in NI-DAQmx for more information on how the source terminal is used in various applications.</p>
<h5>Ctr0InternalOutput, Ctr1InternalOutput, Ctr2InternalOutput, Ctr3InternalOutput</h5>
<p>Terminals within a device where you can choose the pulsed or toggled output of the counters. Refer to Counter Parts in NI-DAQmx (or MAX) for more information on internal output terminals.</p>
<h4>Task State Model:</h4>
<p>NI-DAQmx uses a task state model to improve ease of use and speed up driver performance. Have a look at</p>
<p><a href="http://zone.ni.com/reference/en-XX/help/370466V-01/mxcncpts/taskstatemodel/">http://zone.ni.com/reference/en-XX/help/370466V-01/mxcncpts/taskstatemodel/</a></p>
<p><b>Short explanation:</b> The task state model consists of five states</p><ul>
<li>Unverified</li>
<li>Verified</li>
<li>Reserved</li>
<li>Committed</li>
<li>Running</li>
</ul>
<p>You call the Start Task function/VI, Stop Task function/VI, and Control Task function/VI to transition the task from one state to another. The task state model is very flexible. You can choose to interact with as little or as much of the task state model as your application requires.</p>
<h4>Device limitations:</h4>
<p>Keep in mind that ONLY the X-series of the NI cards is capable of doing a Counter Output Pulse Frequency Train with finite numbers of samples by using ONE internal device channel clock (that is the function <code>DAQmxCreateCOPulseChanFreq</code> or <code>CO Pulse Freq</code> in Labview)! All other card series have to use two counters to generate that! Check out the description of NI which tells you <a href="http://digital.ni.com/public.nsf/allkb/9D1780F448D10F4686257590007B15A8">How Many Counters Does Each Type of Counter Input or Output Task Take</a>.</p>
<p>The code in Qudi tested with NI 6323 and NI 6229, where the first one is an X-series device and the latter one is a Low-Cost M Series device. With the NI 6229 it is not possible at all to perform the scanning task unless you have two of that cards. The limitation came from a lack of internal counters. The NI 6323 was taken as a basis for this hardware module and thus all the function are working on that card.</p>
<h2>Configuration</h2>
<p>There are quite a few options for setting up a National instruments card.</p>
<p>Here is an example for a NI6323 card with the name Dev1.</p>
<div class="fragment"><div class="line">mynicard:</div><div class="line">    module.Class: &#39;national_instruments_x_series.NationalInstrumentsXSeries&#39;</div><div class="line">    clock_channel: &#39;/Dev1/Ctr0&#39;</div><div class="line">    scanner_clock_channel: &#39;/Dev1/Ctr2&#39;</div><div class="line">    photon_sources:</div><div class="line">        - &#39;/Dev1/PFI8&#39;</div><div class="line">        - &#39;/Dev1/PFI9&#39;</div><div class="line">    counter_channels:</div><div class="line">        - &#39;/Dev1/Ctr1&#39;</div><div class="line">    counter_ai_channels:  # optional</div><div class="line">        - &#39;/Dev1/AI1&#39;</div><div class="line">    scanner_counter_channels:</div><div class="line">        - &#39;/Dev1/Ctr3&#39;</div><div class="line">    scanner_ai_channels:  # optional</div><div class="line">        - &#39;/Dev1/AI0&#39;</div><div class="line">    scanner_ao_channels:</div><div class="line">        - &#39;/Dev1/AO0&#39;</div><div class="line">        - &#39;/Dev1/AO1&#39;</div><div class="line">        - &#39;/Dev1/AO2&#39;</div><div class="line">        - &#39;/Dev1/AO3&#39;</div><div class="line">    scanner_position_ranges:</div><div class="line">        - [0e-6, 200e-6]</div><div class="line">        - [0e-6, 200e-6]</div><div class="line">        - [-100e-6, 100e-6]</div><div class="line">        - [-10, 10]</div><div class="line">    scanner_voltage_ranges:</div><div class="line">        - [-10, 10]</div><div class="line">        - [-10, 10]</div><div class="line">        - [-10, 10]</div><div class="line">        - [-10, 10]</div><div class="line">    default_samples_number: 10</div><div class="line">    default_clock_frequency: 100</div><div class="line">    default_scanner_clock_frequency: 100</div><div class="line">    gate_in_channel: &#39;/Dev1/PFI9&#39;</div><div class="line">    counting_edge_rising: True</div><div class="line">    odmr_trigger_channel: &#39;/Dev1/PFI15&#39;</div></div><!-- fragment --><h3>Parameter explanation</h3>
<p><code>clock_channel</code>: A counter channel that will generate the clock for the counter functionality. Required when using the CounterInterface of this module.</p>
<p><code>scanner_clock_channel</code>: a counter channel that will generate the pixel clock for confocal and ODMR scans</p>
<p><code>photon_sources</code>: connectors where pulse generating devices can be connected, like avalance photo diodes Required when using the CounterInterface of this module.</p>
<p><code>counter_channels</code>: counter channels that are used to count the pulses from <code>photon_sources</code> for counting cunctionality</p>
<p><code>counter_ai_channels</code>: optional analog inputs that are treated like <code>counter_channels</code> for counting functionality</p>
<p><code>scanner_counter_channels</code>: counter channels hat are used to record confocal or ODMR scans</p>
<p><code>scanner_ai_channels</code>: optional analog inputs that are used like <code>scanner_counter_channels</code></p>
<p><code>scanner_ao_channels</code>: analog outputs that are used to control a microscope scanner, one for each axis</p>
<p><code>scanner_position_ranges</code>: the real-world positions of the microscope scan ranges, one pair for each axis, in meters</p>
<p><code>scanner_voltage_ranges</code>: voltages that correspond the extreme values of the microscope scanner ranges, one pair for each axis</p>
<p><code>default_samples_number</code>:</p>
<p><code>default_clock_frequency</code>: the standard frequency for the counter sample clock</p>
<p><code>default_scanner_clock_frequency</code>: the standard frequency for the microscope scanner or ODMR pixel clock</p>
<p><code>gate_in_channel</code>: input for gating the counting channels</p>
<p><code>counting_edge_rising</code>: whether to count rising or falling edges</p>
<p><code>odmr_trigger_channel</code>: output for the trigger pulse for ODMR microwave sources</p>
<p><code>pixel_clock_channel</code>: optional output for the confocal pixel clock </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
