<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Qudi: Concept of sampling functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Qudi
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Concept of sampling functions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>General description</h2>
<p>The basic analog waveform shapes (e.g. DC, sine, chirp etc.) to build a waveform from are provided by so called sampling functions. Those sampling functions are the atomic elements to build a waveform from. Each sampling function can be used to calculate analog voltages from a given array representing the discrete timing of arbitrary waveform generators.</p>
<p>For each sampling function properly included into qudi the PulseBlock editor in the GUI automatically includes the function together with its custom parameter set.</p>
<h2>Architecture</h2>
<p>Each sampling function is a child class of <code>SamplingBase</code>. The base class provides methods to save and restore sampling function instances using <em>qudi</em> StatusVars.</p>
<p>Each <code>PulseBlockElement</code> instance created will contain as many sampling function instances as analog channels active. During initialization the sampling function instance will receive a desired set of parameters needed for the respective function evaluation of the sampling function. In case of the sampling function <code>Sin</code> this would be <code>amplitude</code>, <code>frequency</code> and <code>phase</code>.</p>
<p>In order to inspect this function specific parameter set, each sampling function class contains an attribute <code>params</code>. It is a dictionary with keys being the parameter names and values being dictionaries holding information about the parameter like default value, unit, domain of definition etc. All keys in the <code>params</code> dictionary are keyword arguments of the sampling function <code>__init__</code>.</p>
<p>The class <code>SamplingFunctions</code> has a classmethod <code>import_sampling_functions</code> which imports all child classes of <code>SamplingBase</code> as sampling functions and attaches the imported class names as callable to the <code>SamplingFunctions</code> class. It also combines all <code>params</code> dictionaries into a single one called <code>parameters</code> where the keys are the sampling function names.</p>
<p><b>WARNING:</b> <em>The class attributes of</em> <code>SamplingFunctions</code> <em>can change during runtime. Do NOT keep references to class attributes in order to avoid a mismatch of definitions.</em></p>
<p>When activating the <code>SequenceGeneratorLogic</code>, <code>import_sampling_functions</code> will be called with the proper import paths. The default import path is ./logic/pulsed/sampling_function_defs/. An additional import path can be set using the <code>ConfigOption</code> <code>additional_sampling_functions_path</code>.</p>
<h2>Class signature</h2>
<p>Each sampling function class must meet the following requirements:</p><ul>
<li>The parent class must be <code>SamplingBase</code> or another sampling function class</li>
<li><code>__init__</code> method must have all function parameters as optional keyword arguments.</li>
<li>The class attribute <code>params</code> must be specified for all parameters (see <code>basic_sampling_functions.py</code> as example) The attributes for each parameter are:<ul>
<li><code>'unit'</code> (The (SI) unit of the parameter)</li>
<li><code>'init'</code> (The default value of the parameter)</li>
<li><code>'min'</code> (The minimum allowed value of the parameter)</li>
<li><code>'max'</code> (The maximum allowed value of the parameter)</li>
<li><code>'type'</code> (The python type of the parameter. allowed types: <code>int</code>, <code>float</code>, <code>str</code>, <code>bool</code>)</li>
</ul>
</li>
<li>If a parameter is not given in a call to <code>__init__</code>, it must be set using its default value defined in <code>params</code></li>
<li>Allowed parameter types are <code>int</code>, <code>float</code>, <code>str</code> and <code>bool</code>. Depending on the type the GUI will automatically create the proper input widget.</li>
<li>Must implement a method <code>get_samples</code> which has only one argument <code>time_array</code>. This function will calculate and return the analog voltages corresponding to the time bins provided by <code>time_array</code>.</li>
</ul>
<h2>Adding new sampling functions procedure</h2>
<ol type="1">
<li>Define a class with <code>SamplingBase</code> or another sampling function class as the parent class. The class name should be the function name.</li>
<li>Define all function parameters in <code>params</code> dictionary. (see section "Class signature")</li>
<li>Define <code>__init__</code> with all parameters as optional arguments. Upon creating an instance the parameters must be saved as instance variables. (use default values if necessary)</li>
<li>Implement <code>get_samples</code> to actually calculate the analog samples.</li>
</ol>
<ol type="1">
<li>Place the module containing your class definitions in the default directory to import from (<code>./logic/pulsed/sampling_function_defs/</code>) or put it in a custom directory and specify the path in your config for the <code>SequenceGeneratorLogic</code> as ConfigOption "additional_sampling_functions_path".</li>
</ol>
<p>You can also simply add your new classes to an already existing module.</p>
<p>By default <em>qudi</em> ships with the default sampling functions defined in <code>./logic/pulsed/sampling_function_defs/basic_sampling_functions.py</code>. This module should not be altered unless you intend to contribute your sampling functions to the <em>qudi</em> repository.</p>
<p>A template for a new sampling function class could look like: </p><div class="fragment"><div class="line">class MyFunc(SamplingBase):</div><div class="line">    &quot;&quot;&quot; Description goes here &quot;&quot;&quot;</div><div class="line">    params = OrderedDict()</div><div class="line">    params[&#39;my_float_param&#39;] = {&#39;unit&#39;: &#39;V&#39;, &#39;init&#39;: 0.0, &#39;min&#39;: 0.0, &#39;max&#39;: np.inf, &#39;type&#39;: float}</div><div class="line">    params[&#39;my_int_param&#39;] = {&#39;unit&#39;: &#39;&#39;, &#39;init&#39;: 0, &#39;min&#39;: 0, &#39;max&#39;: 42, &#39;type&#39;: int}</div><div class="line"></div><div class="line">    def __init__(self, my_float_param=None, my_int_param=None):</div><div class="line">        if my_float_param is None:</div><div class="line">            self.my_float_param = params[&#39;my_float_param&#39;][&#39;init&#39;]</div><div class="line">        else:</div><div class="line">            self.my_float_param = my_float_param</div><div class="line">        if my_int_param is None:</div><div class="line">            self.my_int_param = params[&#39;my_int_param&#39;][&#39;init&#39;]</div><div class="line">        else:</div><div class="line">            self.my_int_param = my_int_param</div><div class="line">        return</div><div class="line"></div><div class="line">    def get_samples(self, time_array):</div><div class="line">        # Calculate samples</div><div class="line">        return np.zeros(time_array.size)</div><div class="line"></div><div class="line">    def _some_helper_method(self):</div><div class="line">        pass</div><div class="line"></div><div class="line"></div><div class="line">class MyFuncWithNewName(MyFunc):</div><div class="line">    &quot;&quot;&quot; This is the same sampling function as MyFunc but it is now called MyFuncWithNewName &quot;&quot;&quot;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
