<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Qudi: Concept of predefined generate methods</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Qudi
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Concept of predefined generate methods </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>General description</h2>
<p>We call predefined generate methods a method that programmatically arranges <code>PulseBlockElement</code> instances in order to generate a <code>PulseBlockEnsemble</code> or <code>PulseSequence</code> instance without using the (graphical) pulse editors. In addition these methods also define the actual pulsed measurement they are designed for by adding all necessary measurement parameters to the created object instance dict attribute <code>measurement_information</code>.</p>
<p>For each predefined method properly included into qudi the GUI can automatically create an easy interface to create a pulsed measurement sequence with a custom parameter set.</p>
<h2>Architecture</h2>
<p>Each generate method is a bound method of a child class of <code>PredefinedGeneratorBase</code>. This base class provides read-only access to important attributes of <code>SequenceGeneratorLogic</code> via properties. (see ./logic/pulsed/pulse_objects.py) For the generation you can therefore access all the information contained in <code>SequenceGeneratorLogic</code>, namely:</p><ul>
<li><code>pulse_generator_settings</code> (dict containing the current settings for the pulse generator hardware)</li>
<li><code>generation_parameters</code> (dict containing commonly used generation parameters, e.g. rabi_period, laser_channel etc.)</li>
<li><code>channel_set</code> (set of currently active analog and digital channels)</li>
<li><code>analog_channels</code> (set of currently active analog channels)</li>
<li><code>digital_channels</code> (set of currently active digital channels)</li>
<li><code>laser_channel</code> (string descriptor of the currently selected laser trigger channel)</li>
<li><code>sync_channel</code> (string descriptor of the currently selected counter sync trigger channel)</li>
<li><code>gate_channel</code> (string descriptor of the currently selected counter gate trigger channel)</li>
<li><code>analog_trigger_voltage</code> (logical high voltage in case an analog channel is used as trigger)</li>
<li><code>laser_delay</code> (the delay in seconds between the laser trigger and the actual laser exposure)</li>
<li><code>microwave_channel</code> (the pulse generator channel used for microwave generation)</li>
<li><code>microwave_frequency</code> (the microwave frequency to be used)</li>
<li><code>microwave_amplitude</code> (the microwave amplitude to be used)</li>
<li><code>laser_length</code> (dict containing the current settings for the fast counter hardware)</li>
<li><code>wait_time</code> (the wait time after a laser pulse before any microwave irradiation takes place)</li>
<li><code>rabi_period</code> (the rabi period of the spin to manipulate in seconds)</li>
<li><code>sample_rate</code> (the sampling rate of the hardware device)</li>
</ul>
<p>If you need access to another attribute of the logic module simply add it as property to <code>PredefinedGeneratorBase</code> but make sure to protect it properly against changes to the logic module.</p>
<p>The base class also provides commonly used helper methods to reduce code duplication in the actual generate methods. If you think a helper method of general interest is missing feel free to add it to the base class.</p>
<p>In addition the base class provides access to the qudi logger which can be used just like in any other qudi module, e.g. `self.log.warning('I am a warning!')`</p>
<p>All parameters needed for the generation that can not be provided by the logic module need to be handed over to the generation method directly as keyword arguments with default value.</p>
<p>When activating the <code>SequenceGeneratorLogic</code>, an instance of <code>PulseObjectGenerator</code> will be created. This class finds and imports all child classes of <code>PredefinedGeneratorBase</code> from the default directory ./logic/pulsed/predefined_generate_methods/. It will also inspect the generate methods and create two dictionaries. One is holding references to the method itself and the other contains the keyword arguments together with the currently set values for each generation method. In both cases the dictionary keys are the method names excluding the "generate_" naming prefix. Those two dictionaries can be accessed via properties of <code>PulseObjectGenerator</code>. The property holding the generation parameters is masked in order to only return or set the parameter set for the currently selected generation method.</p>
<h2>Method signature</h2>
<p>Each generation method must meet the following requirements:</p><ul>
<li>Is bound instance method of a <code>PredefinedGeneratorBase</code> child class</li>
<li>Method name starts with prefix <code>generate_</code></li>
<li>Must contain the optional keyword argument <code>name</code> to give the instance to created a name</li>
<li>Additional parameters must be defined as optional keyword arguments</li>
<li>Default values for additional arguments must be of type <code>int</code>, <code>float</code>, <code>str</code>, <code>bool</code> or Enum subclass. Depending on the default argument type the GUI will automatically create the proper input widget.</li>
</ul>
<h2>Adding new methods procedure</h2>
<ol type="1">
<li>Define a class with <code>PredefinedGeneratorBase</code> as the <b>ONLY</b> parent class.</li>
<li>Make sure the base class gets initialized with: ```python def <b>init</b>(self, *args, **kwargs): super().__init__(*args, **kwargs) ```</li>
<li>Define generate methods in new class. (see section "Method signature")</li>
<li>Place the module containing your class definition in the default directory to import from (<code>./logic/pulsed/predefined_generate_methods/</code>) or put it in a custom directory and specify the path in your config for the <code>SequenceGeneratorLogic</code> as ConfigOption "additional_predefined_methods_path".</li>
</ol>
<p>You can also simply add your analysis method to an already existing <code>PredefinedGeneratorBase</code> child class. In that case you just need to follow step 3.</p>
<p>By default <em>qudi</em> ships with the default methods defined in <code>./logic/pulsed/predefined_generate_methods/basic_predefined_methods.py</code>. This module should not be altered unless you intend to contribute your methods to the <em>qudi</em> repository.</p>
<p>A template for a new <code>PredefinedGenerator</code> class could look like: </p><div class="fragment"><div class="line">from enum import Enum</div><div class="line"></div><div class="line"></div><div class="line">class Colour(Enum):</div><div class="line">    red = 1</div><div class="line">    green = 2</div><div class="line">    blue = 3</div><div class="line"></div><div class="line"></div><div class="line">class MyPredefinedGeneratorBase(PredefinedGeneratorBase):</div><div class="line">    &quot;&quot;&quot; Description goes here &quot;&quot;&quot;</div><div class="line">    def __init__(self, *args, **kwargs):</div><div class="line">        super().__init__(*args, **kwargs)</div><div class="line"></div><div class="line">    def generate_my_method_name1(self, name=&#39;my_name&#39;, my_float_param=42.0, my_int_param=42):</div><div class="line">        # Do something</div><div class="line">        pass</div><div class="line"></div><div class="line">    def generate_my_method_name2(self, name=&#39;my_name&#39;, my_str_param=&#39;derp&#39;, my_bool_param=True, my_enum_param=Colour.green):</div><div class="line">        # Do something</div><div class="line">        pass</div><div class="line"></div><div class="line">    def _some_helper_method(self):</div><div class="line">        pass</div></div><!-- fragment --><h3>Advanced use of Enum subclass</h3>
<p>If you have used an Enum subclass as a parameter type of a sampling function then you might want to wish to use the same Enum subclass in the predefined functions.</p>
<p>To do so, you will have to access the sampling function and grab the Enum subclass from there.</p>
<p><b>Attention:</b> Be aware however that this requires the sampling function to be loaded and you have to make sure, that the Enum subclass you are wanting to access really exists. If you access an Enum subclass that does not exist without checking, the loading of qudi will fail!</p>
<p>The following example is requiring the template from the <a class="el" href="sampling_functions.html">sampling functions</a>:</p>
<div class="fragment"><div class="line">from logic.pulsed.sampling_functions import SamplingFunctions</div><div class="line">import sys</div><div class="line"></div><div class="line">if &#39;MyFunc&#39; not in SamplingFunctions.parameters or &#39;my_enum_param&#39; not in SamplingFunctions.parameters[&#39;MyFunc&#39;]:</div><div class="line">    print(&#39;Error: Cannot find the sampling function and therefore cannot supply the required Enums.\n&#39;</div><div class="line">          &#39;Aborting the import of predefined methods in module {}.&#39;.format(__name__), file=sys.stderr)</div><div class="line">else:</div><div class="line">    Colour = SamplingFunctions.parameters[&#39;MyFunc&#39;][&#39;my_enum_param&#39;][&#39;type&#39;]</div><div class="line"></div><div class="line">    class MyPredefinedGenerator(PredefinedGeneratorBase):</div><div class="line">        &quot;&quot;&quot; Description goes here &quot;&quot;&quot;</div><div class="line">        def __init__(self, *args, **kwargs):</div><div class="line">            super().__init__(*args, **kwargs)</div><div class="line"></div><div class="line">        def generate_my_enum_method(self, name=&#39;my_enum_method&#39;, my_enum_param=Colour.green):</div><div class="line">            # Do something</div><div class="line">            pass</div></div><!-- fragment --><p>Notice that the whole class definition is encapsulated in an if-clause and only is loaded, if the Enum-subclass-parameter can be found int the sampling functions. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
